"use strict";

const assert = require(`assert`);
const urlSafeChars = require(`url-safe-chars`);
const uupid = require(`uupid`);
const UuidTranslator = require(`short-uuid`);

const Comparison = (a, b) => {

    const numberComparison = a._number - b._number;

    return (
        numberComparison === 0? 
        a._tiebreaker.localeCompare(b._tiebreaker) 
        : numberComparison
        );

};

const oldest = {_number: 0, _tiebreaker: ``};

const myTiebreaker = UuidTranslator(urlSafeChars).fromUUID(uupid);

module.exports = {

    Comparison,

    oldest,

    validate: (version) => {

        assert(Number.isInteger(version._number));

        assert(typeof version._tiebreaker === `string`);

        assert(Comparison(version, oldest) >= 0);

    },

    Newer: (version) => {

        return {_number: version._number + 1, _tiebreaker: myTiebreaker};

    },

    };