"use strict";

const AbstractStringLog = require(`abstract-string-log`);
const assert = require(`assert`);
const fs = require(`fs`);
const path = require(`path`);
const StoredStringLog = require(`./StoredStringLog.js`);

const encoding = `utf8`;

module.exports = class extends AbstractStringLog {

    constructor ({dir, separator}) {

        this._appendStream = 
            fs.createWriteStream(this._path, {encoding, flags: `a`});

        assert(typeof separator === `string`);

        this._separator = separator;

    }

    Strings () {

        let fileAsString;

        try {

            fileAsString = fs.readFileSync(this._path, {encoding});

        } 
        catch (error) {

            if (error.code === `ENOENT`) {
                fileAsString = ``;
            }
            else {
                throw error;
            }

        }

        const strings = fileAsString.split(this._separator);

        strings.pop();

        return strings;

    }

    clear () {

        fs.writeFileSync(this._path, ``, {encoding});

    }

    addToWriteQueue (string) {

        this._appendStream.write(string + this._separator);

    }

    };