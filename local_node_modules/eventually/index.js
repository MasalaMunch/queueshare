"use strict";

const assert = require(`assert`);
const Queue = require(`queue`);

const taskQueue = new Queue();

const start = () => setTimeout(() => {

    const {func, resolve, reject} = taskQueue.OldestItem();

    try {

        resolve(func());

    } catch (error) {

        reject(error);

    }

    taskQueue.deleteOldestItem();

    if (!taskQueue.IsEmpty()) {

        start();

    }

}, 0);

module.exports = (func) => new Promise((resolve, reject) => {

    assert(typeof func === `function`);

    const isFirstTask = taskQueue.IsEmpty();

    taskQueue.add({func, resolve, reject});

    if (isFirstTask) {

        start();

    }

});